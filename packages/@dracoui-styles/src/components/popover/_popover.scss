/**
 * Copyright (c) Corinvo, LLC. and its partners and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

@use 'sass:list';
@use 'tokens' as *;
@use '@dracoui/primitives';
@use '../../utilities/disable-selection' as *;

// Keyframe animations for popover
@keyframes popover-fade-in {
  from {
    opacity: 0;
    transform: scale(0.96) translateZ(0);
  }
  to {
    opacity: 1;
    transform: scale(1) translateZ(0);
  }
}

@keyframes popover-fade-out {
  from {
    opacity: 1;
    transform: scale(1) translateZ(0);
  }
  to {
    opacity: 0;
    transform: scale(0.96) translateZ(0);
  }
}

// Direction-aware entrance animations
@keyframes popover-slide-in-from-top {
  from {
    opacity: 0;
    transform: scale(0.96) translateY(8px) translateZ(0);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0) translateZ(0);
  }
}

@keyframes popover-slide-in-from-bottom {
  from {
    opacity: 0;
    transform: scale(0.96) translateY(-8px) translateZ(0);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0) translateZ(0);
  }
}

@keyframes popover-slide-in-from-left {
  from {
    opacity: 0;
    transform: scale(0.96) translateX(8px) translateZ(0);
  }
  to {
    opacity: 1;
    transform: scale(1) translateX(0) translateZ(0);
  }
}

@keyframes popover-slide-in-from-right {
  from {
    opacity: 0;
    transform: scale(0.96) translateX(-8px) translateZ(0);
  }
  to {
    opacity: 1;
    transform: scale(1) translateX(0) translateZ(0);
  }
}

@mixin Popover {
  .draco-popover {
    &-surface {
      @include disable-selection;

      display: flex;
      flex-direction: column;
      box-sizing: border-box;
      appearance: none;
      position: absolute;
      font-family: primitives.$draco-font-sans-serif;
      font-weight: $popover-font-weight;
      line-height: 1.4;
      z-index: 99999;

      // GPU accelerated rendering
      contain: layout style paint;
      backface-visibility: hidden;
      -moz-osx-font-smoothing: auto;
      -webkit-font-smoothing: subpixel-antialiased;

      // Default animation (fallback)
      animation: popover-fade-in 200ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;

      @media (prefers-reduced-motion: reduce) {
        animation: none;
      }

      // Direction-aware animations based on placement
      &[data-placement^='top'] {
        animation: popover-slide-in-from-top 250ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }

      &[data-placement^='bottom'] {
        animation: popover-slide-in-from-bottom 250ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }

      &[data-placement^='left'],
      &[data-placement^='before'] {
        animation: popover-slide-in-from-left 250ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }

      &[data-placement^='right'],
      &[data-placement^='after'] {
        animation: popover-slide-in-from-right 250ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }

      // Exit animation when closing
      &[data-open='false'] {
        animation: popover-fade-out 150ms cubic-bezier(0.4, 0, 1, 1) forwards;
      }
    }

    // Popover arrow styles
    &-arrow {
      position: absolute;
      width: $popover-arrow-size;
      height: $popover-arrow-size;
      pointer-events: none;

      &::before {
        content: '';
        position: absolute;
        width: $popover-arrow-size;
        height: $popover-arrow-size;
        background: inherit;
        transform: rotate(45deg);
      }

      // Arrow positioning based on placement (This will change, react aria only!!!)
      [data-placement^='top'] & {
        bottom: calc($popover-arrow-size / -2);
      }

      [data-placement^='bottom'] & {
        top: calc($popover-arrow-size / -2);
      }

      [data-placement^='left'] & {
        right: calc($popover-arrow-size / -2);
      }

      [data-placement^='right'] & {
        left: calc($popover-arrow-size / -2);
      }
    }
  }
}